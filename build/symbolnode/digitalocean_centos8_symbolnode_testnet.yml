---
- hosts: digitalocean
  gather_facts: yes
  #become: yes
  vars:
    user_name: centos
    beneficiaryAddress: TBHQGWBYM2CIIS7KMVDLNXXVQKH3YAYPJXR36TA
    my_preset: my-preset-testnet.yml
    passwd: ilikeddr0

  tasks:
    - name: symbol_testnetディレクトリの作成
      file: path=/home/{{ user_name }}/symbol_testnet state=directory owner={{ user_name }} group={{ user_name }} mode=0755
      tags: dev

    - name: my-preset-testnet.ymlの設置
      template: src={{ my_preset }}.j2 dest=/home/{{ user_name }}/symbol_testnet/{{ my_preset }} owner={{ user_name }} group={{ user_name }} mode=644
      tags: dev

    - name: symbol-bootstrap configの実行
      shell: symbol-bootstrap config -p testnet -a dual -c {{ my_preset }} --password={{ passwd }}
      args:
        chdir: /home/{{ user_name }}/symbol_testnet
        creates: target
      tags: dev

    - name: symbol-bootstrap composeの実行
      shell: symbol-bootstrap compose --password={{ passwd }}
      args:
        chdir: /home/{{ user_name }}/symbol_testnet
      tags: dev

    - name: symbol-bootstrap startの実行
      shell: symbol-bootstrap start -d --password={{ passwd }}
      args:
        chdir: /home/{{ user_name }}/symbol_testnet

    - name: data.tar.gzのダウンロード
      get_url: url="https://symbol-archives.s3-ap-northeast-1.amazonaws.com/archives/data.tar.gz" dest=/tmp

    - name: databases.tar.gzのダウンロード
      get_url: url="https://symbol-archives.s3-ap-northeast-1.amazonaws.com/archives/databases.tar.gz" dest=/tmp
